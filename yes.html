<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>yes üíò</title>
  <style>
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; overflow:hidden;
      display:grid; place-items:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#ff73b9;
    }

    /* Background hearts (soft) */
    #bg{
      position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden;
    }
    .bgH{
      position:absolute; bottom:-60px;
      left:var(--x,50%);
      font-size:var(--s,28px);
      opacity:var(--o,.45);
      transform:translateX(-50%);
      animation:bgUp var(--d,9s) linear var(--del,0s) infinite;
      filter:blur(var(--b,0px));
      text-shadow:0 10px 20px rgba(0,0,0,.12);
    }
    @keyframes bgUp{
      to{ transform:translateX(calc(-50% + var(--dr,0px))) translateY(-130vh) rotate(var(--r,0deg)); }
    }

    .wrap{
      width:min(980px,92vw);
      display:grid;
      place-items:center;
      gap:14px;
      z-index:2;
      text-align:center;
      padding:28px 0;
    }

    .topline{
      font-weight:900;
      font-size:clamp(1.6rem,4.5vw,2.8rem);
      color:#fff3fb;
      text-shadow:0 10px 24px rgba(0,0,0,.18);
      opacity:0;
      animation:fadeLine 6.2s ease forwards;
      margin:0;
    }
    @keyframes fadeLine{
      0%{opacity:0; transform:translateY(6px)}
      12%{opacity:1; transform:translateY(0)}
      60%{opacity:1}
      100%{opacity:0}
    }

    /* Slideshow container */
    #slideshow{
      width:min(760px,92vw);
      height:min(460px,58vh);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 18px 40px rgba(0,0,0,.18);
      background:rgba(255,255,255,.10);
      backdrop-filter: blur(2px);
      display:none;
      position:relative;
      z-index:2;
    }
    #slideImg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:contain;
      padding:18px;
      opacity:0;
      transition:opacity 1800ms ease;
    }
    #slideImg.show{opacity:1}

    /* Envelope wrapper: centered by default */
    #envWrap{
      position:relative;
      width:min(440px,92vw);
      height:300px;
      display:grid;
      place-items:center;
      z-index:5;
    }

    /* Docked state (top-left) */
    #envWrap.docked{
      position:fixed;
      left:14px; top:14px;
      width:320px; height:220px;
      transform-origin: top left;
      transform: scale(.78);
      z-index:10;
    }

    /* Envelope */
    #envelope{
      width:100%;
      height:100%;
      border-radius:18px;
      cursor:pointer;
      filter:drop-shadow(0 18px 36px rgba(0,0,0,.20));
      position:relative;
      user-select:none;
    }
    #envelope:hover{ animation:jitter .18s linear infinite; }
    @keyframes jitter{
      0%{transform:translate(0,0) rotate(0deg)}
      25%{transform:translate(1px,-1px) rotate(-.6deg)}
      50%{transform:translate(-1px,1px) rotate(.6deg)}
      75%{transform:translate(1px,1px) rotate(-.4deg)}
      100%{transform:translate(0,0) rotate(0deg)}
    }

    .back{
      position:absolute; inset:0;
      background:#ffd1e6;
      border:2px solid rgba(255,255,255,.65);
      border-radius:18px;
      overflow:hidden;
    }
    .front{
      position:absolute; left:0; right:0; bottom:0;
      height:62%;
      background:#ffb6d6;
      border-top:2px solid rgba(255,255,255,.65);
      border-radius:0 0 18px 18px;
      z-index:3;
    }
    .flap{
      position:absolute; left:0; right:0; top:0;
      height:62%;
      background:#ffc3de;
      transform-origin: top;
      transform: rotateX(0deg);
      transition: transform 620ms ease;
      z-index:4;
      clip-path: polygon(0 0,100% 0,50% 82%);
      border-bottom:2px solid rgba(255,255,255,.55);
    }
    .seal{
      position:absolute; left:50%; top:58%;
      transform:translate(-50%,-50%);
      width:54px; height:54px; border-radius:999px;
      background:#ff4fa2;
      display:grid; place-items:center;
      color:#fff; font-weight:900;
      z-index:5;
      box-shadow:0 10px 18px rgba(0,0,0,.18);
      transition: opacity 260ms ease;
    }

    /* Full-page letter overlay (THIS is the reliable approach) */
    #letterOverlay{
      position:fixed; inset:0;
      display:none;               /* hidden until open */
      place-items:center;
      z-index:50;
      padding: min(4vh,32px) 16px;
      background: rgba(0,0,0,.10);
      backdrop-filter: blur(2px);
    }
    #letter{
      width:min(720px,92vw);
      height:min(82vh,760px);
      background:#fff7fb;
      border-radius:18px;
      border:2px solid rgba(255,255,255,.9);
      box-shadow:0 28px 70px rgba(0,0,0,.26);
      padding:24px 24px 18px;
      text-align:left;
      color:#5b2745;
      overflow:auto;
      transform: translateY(24px);
      opacity:0;
      transition: transform 520ms ease, opacity 520ms ease;
      cursor:pointer; /* click letter to close */
    }
    #letter.show{
      transform: translateY(0);
      opacity:1;
    }
    #letter h2{ margin:0 0 10px; color:#b21f62; font-size:1.15rem; }
    #letter p{ margin:0 0 12px; line-height:1.6; font-size:1.03rem; white-space:pre-wrap; }
    #letter .sig{ margin-top:10px; font-weight:900; color:#b21f62; font-size:1.05rem; }

    .open .flap{ transform: rotateX(165deg); }
    .open .seal{ opacity:0; }

    .hint{
      margin:0;
      font-weight:800;
      color:rgba(255,255,255,.92);
      text-shadow:0 10px 22px rgba(0,0,0,.14);
      z-index:2;
    }

    /* Foreground heart flood */
    #flood{
      position:fixed; inset:0; pointer-events:none; z-index:9999; overflow:hidden;
      display:none;
    }
    .fH{
      position:absolute;
      top:110%;
      left:var(--x,50%);
      font-size:var(--s,30px);
      opacity:var(--o,.85);
      animation:fUp var(--d,4s) linear var(--del,0s) infinite;
      text-shadow:0 10px 22px rgba(0,0,0,.16);
      filter:blur(var(--b,0px));
    }
    @keyframes fUp{
      to{ transform: translateY(-240vh) rotate(var(--r,0deg)); }
    }

    /* Tiny status (helps you confirm click/audio) */
    #status{
      position:fixed;
      left:10px; bottom:10px;
      font-size:12px;
      color:rgba(255,255,255,.85);
      background:rgba(0,0,0,.18);
      padding:6px 8px;
      border-radius:10px;
      z-index:10000;
      user-select:none;
    }
  </style>
</head>
<body>

  <div id="bg" aria-hidden="true"></div>
  <div id="flood" aria-hidden="true"></div>

  <!-- IMPORTANT: make sure this filename EXACTLY matches your repo file -->
  <audio id="bgm" src="love.m4a" loop preload="auto"></audio>

  <div class="wrap">
    <h1 class="topline">Heh, there was never any doubt.</h1>

    <div id="slideshow" aria-hidden="true">
      <img id="slideImg" alt="Memories">
    </div>

    <div id="envWrap">
      <div id="envelope" role="button" tabindex="0" aria-label="Open envelope">
        <div class="back"></div>
        <div class="flap"></div>
        <div class="seal">‚ù§</div>
        <div class="front"></div>
      </div>
    </div>

    <p class="hint">Click the envelope üíå (click the letter to close)</p>
  </div>

  <!-- Full page letter overlay -->
  <div id="letterOverlay" aria-hidden="true">
    <div id="letter" title="Click to close">
      <h2>Dear Bella,</h2>
      <p>Happy Valentines! I know I cannot be there in person, so I thought I would give you something that you can play around with until we next see each other.

I love you, darling. From that first text message, to our last date. You continue to enchant my world, and I am extremely grateful for your companionship. I have no doubt our love will continue to flourish and endure as it already has. Thank you for being my Valentines, and thank you for being my Pookers.</p>
      <div class="sig">- Louis</div>
    </div>
  </div>

  <div id="status">ready</div>

  <script>
    // ===== Helpers
    const $ = (id)=>document.getElementById(id);
    const rand = (a,b)=>Math.random()*(b-a)+a;

    // ===== Background hearts
    (function bgHearts(){
      const wrap = $("bg");
      const chars = ["‚ù§","üíñ","üíò","üíó","üíì","üíû","üíï","ü©∑"];
      for(let i=0;i<64;i++){
        const h=document.createElement("div");
        h.className="bgH";
        h.textContent=chars[Math.floor(Math.random()*chars.length)];
        h.style.setProperty("--x", rand(0,100)+"%");
        h.style.setProperty("--s", rand(16,46)+"px");
        h.style.setProperty("--o", rand(0.18,0.65));
        h.style.setProperty("--d", rand(5.5,12)+"s");
        h.style.setProperty("--del", rand(0,7)+"s");
        h.style.setProperty("--dr", rand(-220,220)+"px");
        h.style.setProperty("--r", rand(-180,180)+"deg");
        h.style.setProperty("--b", (Math.random()<0.18?rand(0.6,1.8):0)+"px");
        wrap.appendChild(h);
      }
    })();

    // ===== Slideshow (slow; ends on WA0021 and stays, then flood)
    const slideshow = $("slideshow");
    const slideImg = $("slideImg");
    const finalSlide = "IMG-20251121-WA0021.jpg";

    const slides = [
      "IMG_20250919_214014_378.jpg",
      "IMG_20250928_181340_332.jpg",
      "IMG_20250929_164834_236.jpg",
      "IMG_20251011_214133_095.jpg",
      "IMG-20251121-WA0030.jpg",
      "IMG-20251121-WA0033.jpg",
      "IMG-20251121-WA0043.jpg",
      "IMG-20251121-WA0066.jpg",
      "IMG-20251122-WA0044.jpg",
      "IMG_20251213_213841_295.jpg",
      "IMG_20251220_025546_696.jpg",
      "IMG-20251121-WA0021.jpg"
    ];

    let slideIndex=0, slideTimer=null;
    const holdMs=6200, fadeOutMs=1900;

    function setSlide(src){
      slideImg.classList.remove("show");
      slideImg.src = src;
      setTimeout(()=>slideImg.classList.add("show"), 30);
    }
    function startSlideshow(){
      slideshow.style.display="block";
      slideshow.setAttribute("aria-hidden","false");
      if(slideTimer) return;
      slideIndex=0;
      runSlide();
    }
    function stopSlideshow(){
      slideshow.style.display="none";
      slideshow.setAttribute("aria-hidden","true");
      slideImg.classList.remove("show");
      if(slideTimer){ clearTimeout(slideTimer); slideTimer=null; }
    }
    function runSlide(){
      const src = slides[slideIndex];
      if(src === finalSlide){
        setSlide(src);
        slideTimer=null;
        setTimeout(startFlood, 900);
        return;
      }
      setSlide(src);
      slideTimer = setTimeout(()=>{
        slideImg.classList.remove("show");
        slideTimer = setTimeout(()=>{
          slideIndex = Math.min(slideIndex+1, slides.length-1);
          runSlide();
        }, fadeOutMs);
      }, holdMs);
    }

    // ===== Flood hearts (foreground)
    const flood = $("flood");
    let flooded=false;
    function startFlood(){
      if(flooded) return;
      flooded=true;
      flood.style.display="block";
      const chars=["‚ù§","üíñ","üíò","üíó","üíì","üíû","üíï","ü©∑"];
      for(let i=0;i<170;i++){
        const h=document.createElement("div");
        h.className="fH";
        h.textContent=chars[Math.floor(Math.random()*chars.length)];
        h.style.setProperty("--x", rand(0,100)+"%");
        h.style.setProperty("--s", rand(18,58)+"px");
        h.style.setProperty("--o", rand(0.25,0.95));
        h.style.setProperty("--d", rand(2.6,5.2)+"s");
        h.style.setProperty("--del", rand(0,2.8)+"s");
        h.style.setProperty("--r", rand(-220,220)+"deg");
        h.style.setProperty("--b", (Math.random()<0.18?rand(0.6,1.8):0)+"px");
        flood.appendChild(h);
      }
    }

    // ===== Envelope / Letter / Audio (robust)
    const envWrap = $("envWrap");
    const envelope = $("envelope");
    const letterOverlay = $("letterOverlay");
    const letter = $("letter");
    const bgm = $("bgm");
    const status = $("status");

    let audioStarted=false;
    let open=false;
    let docked=false;

    async function tryPlayAudio(){
      if(audioStarted) return true;
      try{
        await bgm.play();
        audioStarted=true;
        status.textContent="music: playing";
        return true;
      }catch(err){
        status.textContent="music: blocked/404 (check filename)";
        return false;
      }
    }

    function openEnvelope(){
      open=true;
      docked=false;
      envWrap.classList.remove("docked");
      envelope.classList.add("open");

      // show letter overlay
      letterOverlay.style.display="grid";
      letterOverlay.setAttribute("aria-hidden","false");
      requestAnimationFrame(()=>letter.classList.add("show"));

      stopSlideshow();
      status.textContent="opened";
    }

    function closeLetterAndDock(){
      // hide letter overlay first
      letter.classList.remove("show");
      setTimeout(()=>{
        letterOverlay.style.display="none";
        letterOverlay.setAttribute("aria-hidden","true");
      }, 520);

      open=false;
      docked=true;
      envelope.classList.remove("open");
      envWrap.classList.add("docked");
      startSlideshow();
      status.textContent="docked + slideshow";
    }

    // Click envelope: open + play music
    function onEnvelopeActivate(){
      // This click is the user gesture: audio MUST be started here
      tryPlayAudio();

      // If docked, return center & open
      if(docked){ openEnvelope(); return; }
      if(!open){ openEnvelope(); }
    }

    envelope.addEventListener("click", onEnvelopeActivate);
    envelope.addEventListener("keydown",(e)=>{
      if(e.key==="Enter" || e.key===" "){
        e.preventDefault();
        onEnvelopeActivate();
      }
    });

    // Click letter itself closes & docks
    letter.addEventListener("click",(e)=>{
      e.stopPropagation();
      closeLetterAndDock();
    });

    // Safety: clicking outside letter (overlay) also closes
    letterOverlay.addEventListener("click",(e)=>{
      if(e.target === letterOverlay && open){
        closeLetterAndDock();
      }
    });

    // Initial state
    stopSlideshow();
    status.textContent="ready (click envelope)";
  </script>
</body>
</html>