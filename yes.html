<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üíò</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root { color-scheme: light; }
    * { box-sizing: border-box; }

    body{
      margin:0; min-height:100vh; overflow:hidden;
      background:#ff73b9;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:grid; place-items:center;
    }

    /* heart overload background */
    #hearts{
      position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden;
    }
    .heart{
      position:absolute; bottom:-60px;
      font-size:var(--size,26px);
      opacity:var(--opacity,.65);
      left:var(--x,50%);
      filter:blur(var(--blur,0px));
      transform:translateX(-50%);
      animation:floatUp var(--dur,7s) linear var(--delay,0s) infinite;
      text-shadow:0 6px 18px rgba(0,0,0,.14);
    }
    @keyframes floatUp{
      0%{ transform:translateX(-50%) translateY(0) rotate(0deg); }
      100%{ transform:translateX(calc(-50% + var(--drift,0px))) translateY(-120vh) rotate(var(--rot,0deg)); }
    }

    .wrap{
      z-index:2; width:min(980px,92vw);
      text-align:center; padding:40px 0;
      color:#ffeef7;
      position:relative;
    }

    .line{
      font-weight:900;
      font-size:clamp(1.6rem,4.5vw,2.8rem);
      color:#fff2fb;
      text-shadow:0 10px 24px rgba(0,0,0,.18);
      opacity:0;
      animation:appearThenFade 6.2s ease forwards;
      margin:0 0 26px;
    }
    @keyframes appearThenFade{
      0%{opacity:0;transform:translateY(6px);}
      12%{opacity:1;transform:translateY(0);}
      60%{opacity:1;}
      100%{opacity:0;}
    }

    /* Slideshow (only shows when letter is closed) */
    #slideshow{
      width:min(720px,92vw);
      height:min(440px,58vh);
      margin: 0 auto 18px;
      position:relative;
      display:none;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(2px);
    }
    #slideImg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:contain; /* no cropping */
      opacity:0;
      transition: opacity 1200ms ease;
      padding: 18px;
    }
    #slideImg.show{ opacity:1; }

    /* Envelope */
    .envelope{
      width:min(420px, 90vw);
      height:280px;
      position:relative;
      cursor:pointer;
      border-radius:18px;
      filter:drop-shadow(0 18px 36px rgba(0,0,0,.20));
      transform:translateZ(0);
      user-select:none;
    }

    /* vibrate on hover */
    .envelope:hover{ animation:jitter 0.18s linear infinite; }
    @keyframes jitter{
      0%{transform:translate(0,0) rotate(0deg);}
      25%{transform:translate(1px,-1px) rotate(-0.6deg);}
      50%{transform:translate(-1px,1px) rotate(0.6deg);}
      75%{transform:translate(1px,1px) rotate(-0.4deg);}
      100%{transform:translate(0,0) rotate(0deg);}
    }

    /* Docked top-left state */
    .dock{
      position:fixed !important;
      left:14px; top:14px;
      transform: scale(0.75) !important;
      transform-origin: top left;
      z-index:10;
      animation:none !important;
    }

    .env-back{
      position:absolute; inset:0;
      background:#ffd1e6;
      border:2px solid rgba(255,255,255,.65);
      border-radius:18px; overflow:hidden;
    }

    .env-front{
      position:absolute; left:0; right:0; bottom:0;
      height:62%;
      background:#ffb6d6;
      border-top:2px solid rgba(255,255,255,.65);
      border-radius:0 0 18px 18px;
      z-index:3;
    }

    .flap{
      position:absolute; left:0; right:0; top:0;
      height:62%;
      background:#ffc3de;
      transform-origin: top;
      transform: rotateX(0deg);
      transition: transform 620ms ease;
      z-index:4;
      clip-path: polygon(0 0,100% 0,50% 82%);
      border-bottom:2px solid rgba(255,255,255,.55);
    }

    .seal{
      position:absolute; left:50%; top:58%;
      transform:translate(-50%,-50%);
      width:54px; height:54px; border-radius:999px;
      background:#ff4fa2;
      display:grid; place-items:center;
      color:#fff; font-weight:900;
      z-index:5;
      box-shadow:0 10px 18px rgba(0,0,0,.18);
      transition: opacity 280ms ease;
    }

    /* Letter pops fully out and readable */
    .letter{
      position:absolute;
      left:50%;
      bottom:18px;
      transform: translateX(-50%) translateY(95px);
      width: calc(100% - 48px);
      height: 92%;
      background:#fff7fb;
      border-radius:14px;
      border:2px solid rgba(255,255,255,.85);
      z-index:2;
      padding: 18px 18px 16px;
      text-align:left;
      overflow:auto;
      color:#5b2745;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.04);
      opacity:0;
      transition: transform 820ms ease, opacity 520ms ease;
    }

    .letter h2{
      margin:0 0 10px;
      font-size:1.05rem;
      color:#b21f62;
    }
    .letter p{
      margin:0 0 12px;
      line-height:1.45;
      font-size:0.98rem;
      white-space:pre-wrap;
    }
    .sig{
      margin-top:10px;
      font-weight:900;
      color:#b21f62;
    }

    /* Open state */
    .open .flap{ transform: rotateX(165deg); }
    .open .letter{
      transform: translateX(-50%) translateY(-46px); /* fully out */
      opacity:1;
    }
    .open .seal{ opacity:0; }

    .hint{
      margin-top:12px;
      font-weight:800;
      color:rgba(255,255,255,.92);
      text-shadow:0 10px 22px rgba(0,0,0,.14);
    }
  </style>
</head>
<body>

  <div id="hearts" aria-hidden="true"></div>

  <!-- Audio (must exist in repo) -->
  <audio id="bgm" src="love.m4a" loop preload="auto"></audio>

  <div class="wrap">
    <div class="line">Heh, there was never any doubt.</div>

    <div id="slideshow" aria-hidden="true">
      <img id="slideImg" alt="Memories">
    </div>

    <div id="env" class="envelope" role="button" aria-label="Open letter" tabindex="0">
      <div class="env-back"></div>
      <div class="flap"></div>
      <div class="seal">‚ù§</div>

      <div class="letter" aria-hidden="true">
        <h2>Dear Bella,</h2>
        <p>Happy Valentines! I know I cannot be there in person, so I thought I would give you something that you can play around with until we next see each other.

I love you, darling. From that first text message, to our last date. You continue to enchant my world, and I am extremely grateful for your companionship. I have no doubt our love will continue to flourish and endure as it already has. Thank you for being my Valentines, and thank you for being my Pookers.</p>
        <div class="sig">- Louis</div>
      </div>

      <div class="env-front"></div>
    </div>

    <div class="hint">Click the letter üíå</div>
  </div>

  <script>
    // ----- Hearts overload background -----
    (function initHearts(){
      const wrap = document.getElementById("hearts");
      const chars = ["‚ù§","üíñ","üíò","üíó","üíì","üíû","üíï","ü©∑"];
      const count = 60;
      function rand(min,max){ return Math.random()*(max-min)+min; }

      for (let i=0;i<count;i++){
        const el=document.createElement("div");
        el.className="heart";
        el.textContent=chars[Math.floor(Math.random()*chars.length)];

        el.style.setProperty("--x", rand(0,100) + "%");
        el.style.setProperty("--size", rand(16,44) + "px");
        el.style.setProperty("--opacity", rand(0.18,0.65));
        el.style.setProperty("--dur", rand(5.2,11.5) + "s");
        el.style.setProperty("--delay", rand(0,7.5) + "s");
        el.style.setProperty("--drift", rand(-220,220) + "px");
        el.style.setProperty("--rot", rand(-180,180) + "deg");
        el.style.setProperty("--blur", (Math.random()<0.18 ? rand(0.6,1.8) : 0) + "px");

        wrap.appendChild(el);
      }
    })();

    // ----- Slideshow -----
    const slideshow = document.getElementById("slideshow");
    const slideImg = document.getElementById("slideImg");

    // Put these image files in your repo root OR an /images folder and update paths accordingly:
    const slides = [
      "IMG_20250928_181340_332.jpg",
      "IMG_20251220_025546_696.jpg",
      "IMG-20251121-WA0033.jpg",
      "IMG-20251121-WA0066.jpg",
      "IMG-20251122-WA0044.jpg",
      "IMG-20251121-WA0030.jpg"
    ];

    let slideIndex = 0;
    let slideTimer = null;
    const fadeInMs = 1200;
    const holdMs = 2800;
    const fadeOutMs = 1200;

    function showSlideshow(){
      slideshow.style.display = "block";
      slideshow.setAttribute("aria-hidden","false");

      if (slideTimer) return;
      slideIndex = 0;
      runSlide();
    }

    function hideSlideshow(){
      slideshow.style.display = "none";
      slideshow.setAttribute("aria-hidden","true");
      slideImg.classList.remove("show");
      if (slideTimer){
        clearTimeout(slideTimer);
        slideTimer = null;
      }
    }

    function runSlide(){
      const src = slides[slideIndex % slides.length];
      slideImg.classList.remove("show");

      // wait fade-out, swap, fade-in
      slideTimer = setTimeout(() => {
        slideImg.src = src;
        // ensure it loads then fade in
        slideImg.onload = () => slideImg.classList.add("show");
        slideImg.classList.add("show");

        // hold then fade out then next
        slideTimer = setTimeout(() => {
          slideImg.classList.remove("show");
          slideTimer = setTimeout(() => {
            slideIndex++;
            runSlide();
          }, fadeOutMs);
        }, holdMs);

      }, fadeOutMs);
    }

    // ----- Envelope open/close + docking + audio loop -----
    const env = document.getElementById("env");
    const letter = env.querySelector(".letter");
    const bgm = document.getElementById("bgm");

    let isOpen = false;
    let isDocked = false;
    let audioStarted = false;

    async function startAudio(){
      if (audioStarted) return;
      try{
        await bgm.play();
        audioStarted = true;
      }catch(e){
        // Autoplay restrictions: if it fails, it will work on next click.
      }
    }

    function openLetter(){
      isOpen = true;
      isDocked = false;
      env.classList.remove("dock");
      env.classList.add("open");
      letter.setAttribute("aria-hidden","false");
      hideSlideshow();
      startAudio(); // starts loop on first open
    }

    function closeLetter(){
      isOpen = false;
      env.classList.remove("open");
      letter.setAttribute("aria-hidden","true");

      // dock top-left so it can be clicked again
      isDocked = true;
      env.classList.add("dock");

      // start slideshow when closed
      showSlideshow();
    }

    function handleEnvelopeClick(){
      // If docked, first return to center + open
      if (isDocked){
        openLetter();
        return;
      }
      // Toggle open/close
      if (!isOpen) openLetter();
      else closeLetter();
    }

    env.addEventListener("click", handleEnvelopeClick);
    env.addEventListener("keydown", (e)=>{
      if (e.key==="Enter" || e.key===" "){
        e.preventDefault();
        handleEnvelopeClick();
      }
    });

    // Start in "closed in center" (no slideshow yet). If you WANT slideshow immediately, call showSlideshow() here.
    hideSlideshow();
  </script>
</body>
</html>